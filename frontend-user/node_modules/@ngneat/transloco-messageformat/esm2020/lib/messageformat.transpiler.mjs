import { Inject, Injectable, Optional } from '@angular/core';
import { DefaultTranspiler, getValue, isObject, setValue, TRANSLOCO_CONFIG, } from '@ngneat/transloco';
import { TRANSLOCO_MESSAGE_FORMAT_CONFIG, } from './messageformat.config';
import { cachedFactory, defaultFactory, } from './messageformat.factory';
import * as i0 from "@angular/core";
export class MessageFormatTranspiler extends DefaultTranspiler {
    constructor(config, userConfig) {
        super(userConfig);
        const { locales, enableCache = true, ...messageConfig } = { locales: null, ...config };
        this.messageConfig = messageConfig;
        this.mfFactory = enableCache ? cachedFactory : defaultFactory;
        this.messageFormat = this.mfFactory(locales, messageConfig);
    }
    transpile(value, params = {}, translation, key) {
        if (!value) {
            return value;
        }
        if (isObject(value) && params) {
            Object.keys(params).forEach((p) => {
                const v = getValue(value, p);
                const getParams = getValue(params, p);
                const transpiled = super.transpile(v, getParams, translation, key);
                const message = this.messageFormat.compile(transpiled);
                value = setValue(value, p, message(params[p]));
            });
        }
        else if (!Array.isArray(value)) {
            const transpiled = super.transpile(value, params, translation, key);
            const message = this.messageFormat.compile(transpiled);
            return message(params);
        }
        return value;
    }
    onLangChanged(lang) {
        this.setLocale(lang);
    }
    setLocale(locale) {
        this.messageFormat = this.mfFactory(locale, this.messageConfig);
    }
}
MessageFormatTranspiler.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.10", ngImport: i0, type: MessageFormatTranspiler, deps: [{ token: TRANSLOCO_MESSAGE_FORMAT_CONFIG, optional: true }, { token: TRANSLOCO_CONFIG, optional: true }], target: i0.ɵɵFactoryTarget.Injectable });
MessageFormatTranspiler.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "13.3.10", ngImport: i0, type: MessageFormatTranspiler });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.10", ngImport: i0, type: MessageFormatTranspiler, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: undefined, decorators: [{
                    type: Optional
                }, {
                    type: Inject,
                    args: [TRANSLOCO_MESSAGE_FORMAT_CONFIG]
                }] }, { type: undefined, decorators: [{
                    type: Optional
                }, {
                    type: Inject,
                    args: [TRANSLOCO_CONFIG]
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnZWZvcm1hdC50cmFuc3BpbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vbGlicy90cmFuc2xvY28tbWVzc2FnZWZvcm1hdC9zcmMvbGliL21lc3NhZ2Vmb3JtYXQudHJhbnNwaWxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDN0QsT0FBTyxFQUNMLGlCQUFpQixFQUNqQixRQUFRLEVBRVIsUUFBUSxFQUNSLFFBQVEsRUFFUixnQkFBZ0IsR0FFakIsTUFBTSxtQkFBbUIsQ0FBQztBQUczQixPQUFPLEVBR0wsK0JBQStCLEdBQ2hDLE1BQU0sd0JBQXdCLENBQUM7QUFDaEMsT0FBTyxFQUNMLGFBQWEsRUFDYixjQUFjLEdBRWYsTUFBTSx5QkFBeUIsQ0FBQzs7QUFHakMsTUFBTSxPQUFPLHVCQUF3QixTQUFRLGlCQUFpQjtJQUs1RCxZQUdFLE1BQTJCLEVBQ1csVUFBNEI7UUFFbEUsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ2xCLE1BQU0sRUFDSixPQUFPLEVBQ1AsV0FBVyxHQUFHLElBQUksRUFDbEIsR0FBRyxhQUFhLEVBQ2pCLEdBQUcsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLEdBQUcsTUFBTSxFQUFFLENBQUM7UUFDakMsSUFBSSxDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUM7UUFDbkMsSUFBSSxDQUFDLFNBQVMsR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDO1FBQzlELElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLEVBQUUsYUFBYSxDQUFDLENBQUM7SUFDOUQsQ0FBQztJQUVELFNBQVMsQ0FBQyxLQUFVLEVBQUUsU0FBa0IsRUFBRSxFQUFFLFdBQXdCLEVBQUUsR0FBVztRQUMvRSxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ1YsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUNELElBQUksUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLE1BQU0sRUFBRTtZQUM3QixNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFO2dCQUNoQyxNQUFNLENBQUMsR0FBRyxRQUFRLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUM3QixNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUN0QyxNQUFNLFVBQVUsR0FBRyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLEdBQUcsQ0FBQyxDQUFDO2dCQUNuRSxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztnQkFDdkQsS0FBSyxHQUFHLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2pELENBQUMsQ0FBQyxDQUFDO1NBQ0o7YUFBTSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUNoQyxNQUFNLFVBQVUsR0FBRyxLQUFLLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBRXBFLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ3ZELE9BQU8sT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ3hCO1FBRUQsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRUQsYUFBYSxDQUFDLElBQVk7UUFDeEIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN2QixDQUFDO0lBRUQsU0FBUyxDQUFDLE1BQWdCO1FBQ3hCLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQ2xFLENBQUM7O3FIQWxEVSx1QkFBdUIsa0JBT3hCLCtCQUErQiw2QkFFbkIsZ0JBQWdCO3lIQVQzQix1QkFBdUI7NEZBQXZCLHVCQUF1QjtrQkFEbkMsVUFBVTs7MEJBT04sUUFBUTs7MEJBQ1IsTUFBTTsyQkFBQywrQkFBK0I7OzBCQUV0QyxRQUFROzswQkFBSSxNQUFNOzJCQUFDLGdCQUFnQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdCwgSW5qZWN0YWJsZSwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gIERlZmF1bHRUcmFuc3BpbGVyLFxuICBnZXRWYWx1ZSxcbiAgSGFzaE1hcCxcbiAgaXNPYmplY3QsXG4gIHNldFZhbHVlLFxuICBUcmFuc2xhdGlvbixcbiAgVFJBTlNMT0NPX0NPTkZJRyxcbiAgVHJhbnNsb2NvQ29uZmlnLFxufSBmcm9tICdAbmduZWF0L3RyYW5zbG9jbyc7XG5pbXBvcnQgTWVzc2FnZUZvcm1hdCwgeyBNZXNzYWdlRm9ybWF0T3B0aW9ucyB9IGZyb20gJ0BtZXNzYWdlZm9ybWF0L2NvcmUnO1xuXG5pbXBvcnQge1xuICBNZXNzYWdlZm9ybWF0Q29uZmlnLFxuICBNRkxvY2FsZSxcbiAgVFJBTlNMT0NPX01FU1NBR0VfRk9STUFUX0NPTkZJRyxcbn0gZnJvbSAnLi9tZXNzYWdlZm9ybWF0LmNvbmZpZyc7XG5pbXBvcnQge1xuICBjYWNoZWRGYWN0b3J5LFxuICBkZWZhdWx0RmFjdG9yeSxcbiAgTUZGYWN0b3J5LFxufSBmcm9tICcuL21lc3NhZ2Vmb3JtYXQuZmFjdG9yeSc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBNZXNzYWdlRm9ybWF0VHJhbnNwaWxlciBleHRlbmRzIERlZmF1bHRUcmFuc3BpbGVyIHtcbiAgcHJpdmF0ZSBtZXNzYWdlRm9ybWF0OiBNZXNzYWdlRm9ybWF0O1xuICBwcml2YXRlIHJlYWRvbmx5IG1lc3NhZ2VDb25maWc6IE1lc3NhZ2VGb3JtYXRPcHRpb25zPCdzdHJpbmcnPjtcbiAgcHJpdmF0ZSByZWFkb25seSBtZkZhY3Rvcnk6IE1GRmFjdG9yeTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBAT3B0aW9uYWwoKVxuICAgIEBJbmplY3QoVFJBTlNMT0NPX01FU1NBR0VfRk9STUFUX0NPTkZJRylcbiAgICBjb25maWc6IE1lc3NhZ2Vmb3JtYXRDb25maWcsXG4gICAgQE9wdGlvbmFsKCkgQEluamVjdChUUkFOU0xPQ09fQ09ORklHKSB1c2VyQ29uZmlnPzogVHJhbnNsb2NvQ29uZmlnXG4gICkge1xuICAgIHN1cGVyKHVzZXJDb25maWcpO1xuICAgIGNvbnN0IHtcbiAgICAgIGxvY2FsZXMsXG4gICAgICBlbmFibGVDYWNoZSA9IHRydWUsXG4gICAgICAuLi5tZXNzYWdlQ29uZmlnXG4gICAgfSA9IHsgbG9jYWxlczogbnVsbCwgLi4uY29uZmlnIH07XG4gICAgdGhpcy5tZXNzYWdlQ29uZmlnID0gbWVzc2FnZUNvbmZpZztcbiAgICB0aGlzLm1mRmFjdG9yeSA9IGVuYWJsZUNhY2hlID8gY2FjaGVkRmFjdG9yeSA6IGRlZmF1bHRGYWN0b3J5O1xuICAgIHRoaXMubWVzc2FnZUZvcm1hdCA9IHRoaXMubWZGYWN0b3J5KGxvY2FsZXMsIG1lc3NhZ2VDb25maWcpO1xuICB9XG5cbiAgdHJhbnNwaWxlKHZhbHVlOiBhbnksIHBhcmFtczogSGFzaE1hcCA9IHt9LCB0cmFuc2xhdGlvbjogVHJhbnNsYXRpb24sIGtleTogc3RyaW5nKTogYW55IHtcbiAgICBpZiAoIXZhbHVlKSB7XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfSAgICBcbiAgICBpZiAoaXNPYmplY3QodmFsdWUpICYmIHBhcmFtcykge1xuICAgICAgT2JqZWN0LmtleXMocGFyYW1zKS5mb3JFYWNoKChwKSA9PiB7XG4gICAgICAgIGNvbnN0IHYgPSBnZXRWYWx1ZSh2YWx1ZSwgcCk7XG4gICAgICAgIGNvbnN0IGdldFBhcmFtcyA9IGdldFZhbHVlKHBhcmFtcywgcCk7XG4gICAgICAgIGNvbnN0IHRyYW5zcGlsZWQgPSBzdXBlci50cmFuc3BpbGUodiwgZ2V0UGFyYW1zLCB0cmFuc2xhdGlvbiwga2V5KTtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IHRoaXMubWVzc2FnZUZvcm1hdC5jb21waWxlKHRyYW5zcGlsZWQpO1xuICAgICAgICB2YWx1ZSA9IHNldFZhbHVlKHZhbHVlLCBwLCBtZXNzYWdlKHBhcmFtc1twXSkpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmICghQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgIGNvbnN0IHRyYW5zcGlsZWQgPSBzdXBlci50cmFuc3BpbGUodmFsdWUsIHBhcmFtcywgdHJhbnNsYXRpb24sIGtleSk7XG5cbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSB0aGlzLm1lc3NhZ2VGb3JtYXQuY29tcGlsZSh0cmFuc3BpbGVkKTtcbiAgICAgIHJldHVybiBtZXNzYWdlKHBhcmFtcyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgb25MYW5nQ2hhbmdlZChsYW5nOiBzdHJpbmcpIHtcbiAgICB0aGlzLnNldExvY2FsZShsYW5nKTtcbiAgfVxuXG4gIHNldExvY2FsZShsb2NhbGU6IE1GTG9jYWxlKSB7XG4gICAgdGhpcy5tZXNzYWdlRm9ybWF0ID0gdGhpcy5tZkZhY3RvcnkobG9jYWxlLCB0aGlzLm1lc3NhZ2VDb25maWcpO1xuICB9XG59XG4iXX0=