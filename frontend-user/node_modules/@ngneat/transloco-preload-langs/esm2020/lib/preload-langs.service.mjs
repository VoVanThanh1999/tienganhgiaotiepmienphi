import { Inject, Injectable, InjectionToken } from '@angular/core';
import { TranslocoService } from '@ngneat/transloco';
import { tap } from 'rxjs/operators';
import { forkJoin } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "@ngneat/transloco";
export const PRELOAD_LANGUAGES = new InjectionToken('Languages to be preloaded');
export class TranslocoPreloadLangsService {
    constructor(service, langs) {
        this.subscription = null;
        if (!langs)
            return;
        this.idleCallbackId = window.requestIdleCallback(() => {
            const preloads = langs.map((currentLangOrScope) => {
                const lang = service._completeScopeWithLang(currentLangOrScope);
                return service.load(lang).pipe(tap(() => {
                    if (service.config.prodMode === false) {
                        console.log(`%c üëÅ Preloaded ${lang}`, 'background: #fff; color: #607D8B;');
                    }
                }));
            });
            this.subscription = forkJoin(preloads).subscribe();
        });
    }
    ngOnDestroy() {
        if (this.idleCallbackId !== undefined) {
            window.cancelIdleCallback(this.idleCallbackId);
        }
        this.subscription?.unsubscribe();
        // Caretaker note: it's important to clean up references to subscriptions since they save the `next`
        // callback within its `destination` property, preventing classes from being GC'd.
        this.subscription = null;
    }
}
TranslocoPreloadLangsService.…µfac = i0.…µ…µngDeclareFactory({ minVersion: "12.0.0", version: "13.3.0", ngImport: i0, type: TranslocoPreloadLangsService, deps: [{ token: i1.TranslocoService }, { token: PRELOAD_LANGUAGES }], target: i0.…µ…µFactoryTarget.Injectable });
TranslocoPreloadLangsService.…µprov = i0.…µ…µngDeclareInjectable({ minVersion: "12.0.0", version: "13.3.0", ngImport: i0, type: TranslocoPreloadLangsService });
i0.…µ…µngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.0", ngImport: i0, type: TranslocoPreloadLangsService, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.TranslocoService }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [PRELOAD_LANGUAGES]
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJlbG9hZC1sYW5ncy5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vbGlicy90cmFuc2xvY28tcHJlbG9hZC1sYW5ncy9zcmMvbGliL3ByZWxvYWQtbGFuZ3Muc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxjQUFjLEVBQWEsTUFBTSxlQUFlLENBQUM7QUFDOUUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDckQsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sRUFBRSxRQUFRLEVBQWdCLE1BQU0sTUFBTSxDQUFDOzs7QUFFOUMsTUFBTSxDQUFDLE1BQU0saUJBQWlCLEdBQUcsSUFBSSxjQUFjLENBQ2pELDJCQUEyQixDQUM1QixDQUFDO0FBR0YsTUFBTSxPQUFPLDRCQUE0QjtJQUl2QyxZQUNFLE9BQXlCLEVBQ0UsS0FBZTtRQUpwQyxpQkFBWSxHQUF3QixJQUFJLENBQUM7UUFNL0MsSUFBSSxDQUFDLEtBQUs7WUFBRSxPQUFPO1FBRW5CLElBQUksQ0FBQyxjQUFjLEdBQUksTUFBYyxDQUFDLG1CQUFtQixDQUFDLEdBQUcsRUFBRTtZQUM3RCxNQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsa0JBQWtCLEVBQUUsRUFBRTtnQkFDaEQsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLHNCQUFzQixDQUFDLGtCQUFrQixDQUFDLENBQUM7Z0JBRWhFLE9BQU8sT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQzVCLEdBQUcsQ0FBQyxHQUFHLEVBQUU7b0JBQ1AsSUFBSSxPQUFPLENBQUMsTUFBTSxDQUFDLFFBQVEsS0FBSyxLQUFLLEVBQUU7d0JBQ3JDLE9BQU8sQ0FBQyxHQUFHLENBQ1QsbUJBQW1CLElBQUksRUFBRSxFQUN6QixtQ0FBbUMsQ0FDcEMsQ0FBQztxQkFDSDtnQkFDSCxDQUFDLENBQUMsQ0FDSCxDQUFDO1lBQ0osQ0FBQyxDQUFDLENBQUM7WUFDSCxJQUFJLENBQUMsWUFBWSxHQUFHLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUNyRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxXQUFXO1FBQ1QsSUFBSSxJQUFJLENBQUMsY0FBYyxLQUFLLFNBQVMsRUFBRTtZQUNwQyxNQUFjLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1NBQ3pEO1FBQ0QsSUFBSSxDQUFDLFlBQVksRUFBRSxXQUFXLEVBQUUsQ0FBQztRQUNqQyxvR0FBb0c7UUFDcEcsa0ZBQWtGO1FBQ2xGLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDO0lBQzNCLENBQUM7O3lIQXJDVSw0QkFBNEIsa0RBTTdCLGlCQUFpQjs2SEFOaEIsNEJBQTRCOzJGQUE1Qiw0QkFBNEI7a0JBRHhDLFVBQVU7OzBCQU9OLE1BQU07MkJBQUMsaUJBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlLCBJbmplY3Rpb25Ub2tlbiwgT25EZXN0cm95IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBUcmFuc2xvY29TZXJ2aWNlIH0gZnJvbSAnQG5nbmVhdC90cmFuc2xvY28nO1xuaW1wb3J0IHsgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgZm9ya0pvaW4sIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuXG5leHBvcnQgY29uc3QgUFJFTE9BRF9MQU5HVUFHRVMgPSBuZXcgSW5qZWN0aW9uVG9rZW48c3RyaW5nW10+KFxuICAnTGFuZ3VhZ2VzIHRvIGJlIHByZWxvYWRlZCdcbik7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBUcmFuc2xvY29QcmVsb2FkTGFuZ3NTZXJ2aWNlIGltcGxlbWVudHMgT25EZXN0cm95IHtcbiAgcHJpdmF0ZSByZWFkb25seSBpZGxlQ2FsbGJhY2tJZDogbnVtYmVyIHwgdW5kZWZpbmVkO1xuICBwcml2YXRlIHN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uIHwgbnVsbCA9IG51bGw7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgc2VydmljZTogVHJhbnNsb2NvU2VydmljZSxcbiAgICBASW5qZWN0KFBSRUxPQURfTEFOR1VBR0VTKSBsYW5nczogc3RyaW5nW11cbiAgKSB7XG4gICAgaWYgKCFsYW5ncykgcmV0dXJuO1xuXG4gICAgdGhpcy5pZGxlQ2FsbGJhY2tJZCA9ICh3aW5kb3cgYXMgYW55KS5yZXF1ZXN0SWRsZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIGNvbnN0IHByZWxvYWRzID0gbGFuZ3MubWFwKChjdXJyZW50TGFuZ09yU2NvcGUpID0+IHtcbiAgICAgICAgY29uc3QgbGFuZyA9IHNlcnZpY2UuX2NvbXBsZXRlU2NvcGVXaXRoTGFuZyhjdXJyZW50TGFuZ09yU2NvcGUpO1xuXG4gICAgICAgIHJldHVybiBzZXJ2aWNlLmxvYWQobGFuZykucGlwZShcbiAgICAgICAgICB0YXAoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHNlcnZpY2UuY29uZmlnLnByb2RNb2RlID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgICAgICBgJWMg8J+RgSBQcmVsb2FkZWQgJHtsYW5nfWAsXG4gICAgICAgICAgICAgICAgJ2JhY2tncm91bmQ6ICNmZmY7IGNvbG9yOiAjNjA3RDhCOydcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgICB0aGlzLnN1YnNjcmlwdGlvbiA9IGZvcmtKb2luKHByZWxvYWRzKS5zdWJzY3JpYmUoKTtcbiAgICB9KTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLmlkbGVDYWxsYmFja0lkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICh3aW5kb3cgYXMgYW55KS5jYW5jZWxJZGxlQ2FsbGJhY2sodGhpcy5pZGxlQ2FsbGJhY2tJZCk7XG4gICAgfVxuICAgIHRoaXMuc3Vic2NyaXB0aW9uPy51bnN1YnNjcmliZSgpO1xuICAgIC8vIENhcmV0YWtlciBub3RlOiBpdCdzIGltcG9ydGFudCB0byBjbGVhbiB1cCByZWZlcmVuY2VzIHRvIHN1YnNjcmlwdGlvbnMgc2luY2UgdGhleSBzYXZlIHRoZSBgbmV4dGBcbiAgICAvLyBjYWxsYmFjayB3aXRoaW4gaXRzIGBkZXN0aW5hdGlvbmAgcHJvcGVydHksIHByZXZlbnRpbmcgY2xhc3NlcyBmcm9tIGJlaW5nIEdDJ2QuXG4gICAgdGhpcy5zdWJzY3JpcHRpb24gPSBudWxsO1xuICB9XG59XG4iXX0=