{"version":3,"file":"ngneat-transloco-preload-langs.mjs","sources":["../../../../libs/transloco-preload-langs/src/lib/preload-langs.service.ts","../../../../libs/transloco-preload-langs/src/lib/preload-langs.module.ts","../../../../libs/transloco-preload-langs/src/ngneat-transloco-preload-langs.ts"],"sourcesContent":["import { Inject, Injectable, InjectionToken, OnDestroy } from '@angular/core';\nimport { TranslocoService } from '@ngneat/transloco';\nimport { tap } from 'rxjs/operators';\nimport { forkJoin, Subscription } from 'rxjs';\n\nexport const PRELOAD_LANGUAGES = new InjectionToken<string[]>(\n  'Languages to be preloaded'\n);\n\n@Injectable()\nexport class TranslocoPreloadLangsService implements OnDestroy {\n  private readonly idleCallbackId: number | undefined;\n  private subscription: Subscription | null = null;\n\n  constructor(\n    service: TranslocoService,\n    @Inject(PRELOAD_LANGUAGES) langs: string[]\n  ) {\n    if (!langs) return;\n\n    this.idleCallbackId = (window as any).requestIdleCallback(() => {\n      const preloads = langs.map((currentLangOrScope) => {\n        const lang = service._completeScopeWithLang(currentLangOrScope);\n\n        return service.load(lang).pipe(\n          tap(() => {\n            if (service.config.prodMode === false) {\n              console.log(\n                `%c ðŸ‘ Preloaded ${lang}`,\n                'background: #fff; color: #607D8B;'\n              );\n            }\n          })\n        );\n      });\n      this.subscription = forkJoin(preloads).subscribe();\n    });\n  }\n\n  ngOnDestroy() {\n    if (this.idleCallbackId !== undefined) {\n      (window as any).cancelIdleCallback(this.idleCallbackId);\n    }\n    this.subscription?.unsubscribe();\n    // Caretaker note: it's important to clean up references to subscriptions since they save the `next`\n    // callback within its `destination` property, preventing classes from being GC'd.\n    this.subscription = null;\n  }\n}\n","import {APP_INITIALIZER, ModuleWithProviders, NgModule} from '@angular/core';\nimport {\n  PRELOAD_LANGUAGES,\n  TranslocoPreloadLangsService,\n} from './preload-langs.service';\n\ninterface IdleDeadline {\n  didTimeout: false;\n  timeRemaining: () => number;\n}\n\n(window as any).requestIdleCallback =\n  (window as any).requestIdleCallback ||\n  function (cb: (deadLine: IdleDeadline) => void) {\n    const start = Date.now();\n\n    return setTimeout(function () {\n      cb({\n        didTimeout: false,\n        timeRemaining: function () {\n          return Math.max(0, 50 - (Date.now() - start));\n        },\n      });\n    }, 1);\n  };\n\n(window as any).cancelIdleCallback =\n  (window as any).cancelIdleCallback ||\n  function (id: number) {\n    clearTimeout(id);\n  };\n\n// eslint-disable-next-line @typescript-eslint/no-empty-function\nfunction noop() {}\n\n@NgModule()\nexport class TranslocoPreloadLangsModule {\n  static forRoot(\n    langs: string[]\n  ): ModuleWithProviders<TranslocoPreloadLangsModule> {\n    return {\n      ngModule: TranslocoPreloadLangsModule,\n      providers: [\n        TranslocoPreloadLangsService,\n        { provide: PRELOAD_LANGUAGES, useValue: langs },\n        {\n          provide: APP_INITIALIZER,\n          useFactory: () => noop,\n          multi: true,\n          deps: [TranslocoPreloadLangsService]\n        },\n      ],\n    };\n  }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}