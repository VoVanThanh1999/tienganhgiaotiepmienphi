{"version":3,"file":"ngx-hover-preload.js","sources":["../../projects/ngx-hover-preload/src/lib/registry.service.ts","../../projects/ngx-hover-preload/src/lib/link.directive.ts","../../projects/ngx-hover-preload/src/lib/hover-preload.strategy.ts","../../projects/ngx-hover-preload/src/lib/hover-preload.module.ts","../../../projects/ngx-hover-preload/src/public-api.ts","../../../projects/ngx-hover-preload/src/ngx-hover-preload.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable } from \"@angular/core\";\nimport { Params, PRIMARY_OUTLET, Router, UrlSegment, UrlSegmentGroup, UrlTree } from \"@angular/router\";\n\n@Injectable({ providedIn: 'root' })\nexport class RegistryService {\n  // Using a map so we don't add an element\n  // on each hover. This will generally reduce memory\n  // usage and will not require cleanup.\n  private _queue = new Set<UrlTree>([]);\n\n  constructor(private router: Router) {}\n\n  add(route: UrlTree) {\n    this._queue.add(route);\n  }\n\n  shouldPrefetch(url: string) {\n    const tree = this.router.parseUrl(url);\n    return [...this._queue].some(containsTree.bind(null, tree));\n  }\n}\n\nfunction containsQueryParams(container: Params, containee: Params): boolean {\n  // TODO: This does not handle array params correctly.\n  return (\n    Object.keys(containee).length <= Object.keys(container).length &&\n    Object.keys(containee).every(key => containee[key] === container[key])\n  );\n}\n\nfunction containsTree(containee: UrlTree, container: UrlTree): boolean {\n  return (\n    containsQueryParams(container.queryParams, containee.queryParams) &&\n    containsSegmentGroup(container.root, containee.root, containee.root.segments)\n  );\n}\n\nfunction containsSegmentGroup(\n  container: UrlSegmentGroup,\n  containee: UrlSegmentGroup,\n  containeePaths: UrlSegment[]\n): boolean {\n  if (container.segments.length > containeePaths.length) {\n    const current = container.segments.slice(0, containeePaths.length);\n    if (!equalPath(current, containeePaths)) return false;\n    if (containee.hasChildren()) return false;\n    return true;\n  } else if (container.segments.length === containeePaths.length) {\n    if (!equalPath(container.segments, containeePaths)) return false;\n    if (!containee.hasChildren()) return true;\n\n    for (const c in containee.children) {\n      if (!container.children[c]) break;\n      if (\n        containsSegmentGroup(\n          container.children[c],\n          containee.children[c],\n          containee.children[c].segments\n        )\n      )\n        return true;\n    }\n    return false;\n  } else {\n    const current = containeePaths.slice(0, container.segments.length);\n    const next = containeePaths.slice(container.segments.length);\n    if (!equalPath(container.segments, current)) return false;\n    if (!container.children[PRIMARY_OUTLET]) return false;\n    return containsSegmentGroup(container.children[PRIMARY_OUTLET], containee, next);\n  }\n}\n\nexport function equalPath(as: UrlSegment[], bs: UrlSegment[]): boolean {\n  if (as.length !== bs.length) return false;\n  return as.every(\n    (a, i) => a.path === bs[i].path || a.path.startsWith(':') || bs[i].path.startsWith(':')\n  );\n}\n","import {\n  Directive, Optional,\n} from '@angular/core';\nimport { RouterLink, RouterLinkWithHref, RouterPreloader } from '@angular/router';\nimport { RegistryService } from './registry.service';\n\n\n\n@Directive({\n  selector: '[routerLink]',\n  host: {\n    '(mouseenter)': 'prefetch()'\n  }\n})\nexport class LinkDirective {\n  private _rl: RouterLink | RouterLinkWithHref;\n  constructor(\n    private _loader: RouterPreloader,\n    private _registry: RegistryService,\n    @Optional() link: RouterLink,\n    @Optional() linkWithHref: RouterLinkWithHref\n  ) {\n    this._rl = link || linkWithHref;\n  }\n\n  prefetch() {\n    requestIdleCallback(() => {\n      this._registry.add(this._rl.urlTree);\n      this._loader.preload().subscribe(() => void 0);\n    });\n  }\n}\n\ntype RequestIdleCallbackHandle = any;\ntype RequestIdleCallbackOptions = {\n  timeout: number;\n};\ntype RequestIdleCallbackDeadline = {\n  readonly didTimeout: boolean;\n  timeRemaining: (() => number);\n};\n\ntype RequestIdleCallback = ((\n  callback: ((deadline: RequestIdleCallbackDeadline) => void),\n  opts?: RequestIdleCallbackOptions\n) => RequestIdleCallbackHandle);\n\nconst requestIdleCallback: RequestIdleCallback =\n  typeof window !== 'undefined'\n    ? (window as any).requestIdleCallback ||\n      function(cb: Function) {\n        const start = Date.now();\n        return setTimeout(function() {\n          cb({\n            didTimeout: false,\n            timeRemaining: function() {\n              return Math.max(0, 50 - (Date.now() - start));\n            }\n          });\n        }, 1);\n      }\n    : () => {};\n","import { Injectable } from '@angular/core';\nimport { PreloadingStrategy, Router, Route, PRIMARY_OUTLET, ActivatedRoute } from '@angular/router';\nimport { EMPTY } from 'rxjs';\nimport { RegistryService } from './registry.service';\n\n@Injectable()\nexport class HoverPreloadStrategy implements PreloadingStrategy {\n  private _loading = new Set<Route>();\n  constructor(private _router: Router, private _registry: RegistryService) {}\n\n  preload(route: Route, load: Function) {\n    if (this._loading.has(route)) {\n      // Don't preload the same route twice\n      return EMPTY;\n    }\n    // Prevent from preloading\n    if (route.data && route.data.preload === false) {\n      return EMPTY;\n    }\n    const path = findPath(this._router.config, route);\n    if (this._registry.shouldPrefetch(path)) {\n      this._loading.add(route);\n      return load();\n    }\n\n    return EMPTY;\n  }\n}\n\nconst findPath = (config: Route[], route: Route): string => {\n  config = config.slice();\n  const parent = new Map<Route, Route>();\n  const visited = new Set<Route>();\n  while (config.length) {\n    const el = config.shift();\n    if (!el) {\n      break;\n    }\n    visited.add(el);\n    if (el === route) break;\n    let children = el.children || [];\n    const current = (el as any)._loadedConfig;\n    if (current && current.routes) {\n      children = children.concat(current.routes);\n    }\n    children.forEach((r: Route) => {\n      if (visited.has(r)) return;\n      parent.set(r, el);\n      config.push(r);\n    });\n  }\n  let path = '';\n  let current = route;\n\n  while (current) {\n    if (isPrimaryRoute(current)) {\n      path = `/${current.path}${path}`;\n    } else {\n      path = `/(${current.outlet}:${current.path}${path})`;\n    }\n    current = parent.get(current)!;\n  }\n\n  return path;\n};\n\nfunction isPrimaryRoute(route: Route) {\n  return route.outlet === PRIMARY_OUTLET || !route.outlet;\n}\n","import { NgModule } from '@angular/core';\nimport { HoverPreloadStrategy } from './hover-preload.strategy';\nimport { LinkDirective } from './link.directive';\n\n\n@NgModule({\n  declarations: [LinkDirective],\n  imports: [],\n  providers: [HoverPreloadStrategy],\n  exports: [LinkDirective]\n})\nexport class HoverPreloadModule { }\n","/*\n * Public API Surface of ngx-hover-preload\n */\n\nexport { LinkDirective as ɵɵLinkDirective } from './lib/link.directive';\nexport { HoverPreloadStrategy } from './lib/hover-preload.strategy';\nexport { HoverPreloadModule } from './lib/hover-preload.module';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n\nexport {RegistryService as ɵa} from './lib/registry.service';"]}