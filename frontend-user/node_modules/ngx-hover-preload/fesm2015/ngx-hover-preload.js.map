{"version":3,"file":"ngx-hover-preload.js","sources":["../../projects/ngx-hover-preload/src/lib/registry.service.ts","../../projects/ngx-hover-preload/src/lib/link.directive.ts","../../projects/ngx-hover-preload/src/lib/hover-preload.strategy.ts","../../projects/ngx-hover-preload/src/lib/hover-preload.module.ts","../../../projects/ngx-hover-preload/src/public-api.ts","../../../projects/ngx-hover-preload/src/ngx-hover-preload.ts"],"sourcesContent":["import { Injectable } from \"@angular/core\";\nimport { Params, PRIMARY_OUTLET, Router, UrlSegment, UrlSegmentGroup, UrlTree } from \"@angular/router\";\n\n@Injectable({ providedIn: 'root' })\nexport class RegistryService {\n  // Using a map so we don't add an element\n  // on each hover. This will generally reduce memory\n  // usage and will not require cleanup.\n  private _queue = new Set<UrlTree>([]);\n\n  constructor(private router: Router) {}\n\n  add(route: UrlTree) {\n    this._queue.add(route);\n  }\n\n  shouldPrefetch(url: string) {\n    const tree = this.router.parseUrl(url);\n    return [...this._queue].some(containsTree.bind(null, tree));\n  }\n}\n\nfunction containsQueryParams(container: Params, containee: Params): boolean {\n  // TODO: This does not handle array params correctly.\n  return (\n    Object.keys(containee).length <= Object.keys(container).length &&\n    Object.keys(containee).every(key => containee[key] === container[key])\n  );\n}\n\nfunction containsTree(containee: UrlTree, container: UrlTree): boolean {\n  return (\n    containsQueryParams(container.queryParams, containee.queryParams) &&\n    containsSegmentGroup(container.root, containee.root, containee.root.segments)\n  );\n}\n\nfunction containsSegmentGroup(\n  container: UrlSegmentGroup,\n  containee: UrlSegmentGroup,\n  containeePaths: UrlSegment[]\n): boolean {\n  if (container.segments.length > containeePaths.length) {\n    const current = container.segments.slice(0, containeePaths.length);\n    if (!equalPath(current, containeePaths)) return false;\n    if (containee.hasChildren()) return false;\n    return true;\n  } else if (container.segments.length === containeePaths.length) {\n    if (!equalPath(container.segments, containeePaths)) return false;\n    if (!containee.hasChildren()) return true;\n\n    for (const c in containee.children) {\n      if (!container.children[c]) break;\n      if (\n        containsSegmentGroup(\n          container.children[c],\n          containee.children[c],\n          containee.children[c].segments\n        )\n      )\n        return true;\n    }\n    return false;\n  } else {\n    const current = containeePaths.slice(0, container.segments.length);\n    const next = containeePaths.slice(container.segments.length);\n    if (!equalPath(container.segments, current)) return false;\n    if (!container.children[PRIMARY_OUTLET]) return false;\n    return containsSegmentGroup(container.children[PRIMARY_OUTLET], containee, next);\n  }\n}\n\nexport function equalPath(as: UrlSegment[], bs: UrlSegment[]): boolean {\n  if (as.length !== bs.length) return false;\n  return as.every(\n    (a, i) => a.path === bs[i].path || a.path.startsWith(':') || bs[i].path.startsWith(':')\n  );\n}\n","import {\n  Directive, Optional,\n} from '@angular/core';\nimport { RouterLink, RouterLinkWithHref, RouterPreloader } from '@angular/router';\nimport { RegistryService } from './registry.service';\n\n\n\n@Directive({\n  selector: '[routerLink]',\n  host: {\n    '(mouseenter)': 'prefetch()'\n  }\n})\nexport class LinkDirective {\n  private _rl: RouterLink | RouterLinkWithHref;\n  constructor(\n    private _loader: RouterPreloader,\n    private _registry: RegistryService,\n    @Optional() link: RouterLink,\n    @Optional() linkWithHref: RouterLinkWithHref\n  ) {\n    this._rl = link || linkWithHref;\n  }\n\n  prefetch() {\n    requestIdleCallback(() => {\n      this._registry.add(this._rl.urlTree);\n      this._loader.preload().subscribe(() => void 0);\n    });\n  }\n}\n\ntype RequestIdleCallbackHandle = any;\ntype RequestIdleCallbackOptions = {\n  timeout: number;\n};\ntype RequestIdleCallbackDeadline = {\n  readonly didTimeout: boolean;\n  timeRemaining: (() => number);\n};\n\ntype RequestIdleCallback = ((\n  callback: ((deadline: RequestIdleCallbackDeadline) => void),\n  opts?: RequestIdleCallbackOptions\n) => RequestIdleCallbackHandle);\n\nconst requestIdleCallback: RequestIdleCallback =\n  typeof window !== 'undefined'\n    ? (window as any).requestIdleCallback ||\n      function(cb: Function) {\n        const start = Date.now();\n        return setTimeout(function() {\n          cb({\n            didTimeout: false,\n            timeRemaining: function() {\n              return Math.max(0, 50 - (Date.now() - start));\n            }\n          });\n        }, 1);\n      }\n    : () => {};\n","import { Injectable } from '@angular/core';\nimport { PreloadingStrategy, Router, Route, PRIMARY_OUTLET, ActivatedRoute } from '@angular/router';\nimport { EMPTY } from 'rxjs';\nimport { RegistryService } from './registry.service';\n\n@Injectable()\nexport class HoverPreloadStrategy implements PreloadingStrategy {\n  private _loading = new Set<Route>();\n  constructor(private _router: Router, private _registry: RegistryService) {}\n\n  preload(route: Route, load: Function) {\n    if (this._loading.has(route)) {\n      // Don't preload the same route twice\n      return EMPTY;\n    }\n    // Prevent from preloading\n    if (route.data && route.data.preload === false) {\n      return EMPTY;\n    }\n    const path = findPath(this._router.config, route);\n    if (this._registry.shouldPrefetch(path)) {\n      this._loading.add(route);\n      return load();\n    }\n\n    return EMPTY;\n  }\n}\n\nconst findPath = (config: Route[], route: Route): string => {\n  config = config.slice();\n  const parent = new Map<Route, Route>();\n  const visited = new Set<Route>();\n  while (config.length) {\n    const el = config.shift();\n    if (!el) {\n      break;\n    }\n    visited.add(el);\n    if (el === route) break;\n    let children = el.children || [];\n    const current = (el as any)._loadedConfig;\n    if (current && current.routes) {\n      children = children.concat(current.routes);\n    }\n    children.forEach((r: Route) => {\n      if (visited.has(r)) return;\n      parent.set(r, el);\n      config.push(r);\n    });\n  }\n  let path = '';\n  let current = route;\n\n  while (current) {\n    if (isPrimaryRoute(current)) {\n      path = `/${current.path}${path}`;\n    } else {\n      path = `/(${current.outlet}:${current.path}${path})`;\n    }\n    current = parent.get(current)!;\n  }\n\n  return path;\n};\n\nfunction isPrimaryRoute(route: Route) {\n  return route.outlet === PRIMARY_OUTLET || !route.outlet;\n}\n","import { NgModule } from '@angular/core';\nimport { HoverPreloadStrategy } from './hover-preload.strategy';\nimport { LinkDirective } from './link.directive';\n\n\n@NgModule({\n  declarations: [LinkDirective],\n  imports: [],\n  providers: [HoverPreloadStrategy],\n  exports: [LinkDirective]\n})\nexport class HoverPreloadModule { }\n","/*\n * Public API Surface of ngx-hover-preload\n */\n\nexport { LinkDirective as ɵɵLinkDirective } from './lib/link.directive';\nexport { HoverPreloadStrategy } from './lib/hover-preload.strategy';\nexport { HoverPreloadModule } from './lib/hover-preload.module';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n\nexport {RegistryService as ɵa} from './lib/registry.service';"],"names":[],"mappings":";;;;MAIa,eAAe;IAM1B,YAAoB,MAAc;QAAd,WAAM,GAAN,MAAM,CAAQ;;;;QAF1B,WAAM,GAAG,IAAI,GAAG,CAAU,EAAE,CAAC,CAAC;KAEA;IAEtC,GAAG,CAAC,KAAc;QAChB,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;KACxB;IAED,cAAc,CAAC,GAAW;QACxB,MAAM,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;QACvC,OAAO,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;KAC7D;;;;YAhBF,UAAU,SAAC,EAAE,UAAU,EAAE,MAAM,EAAE;;;YAFD,MAAM;;AAqBvC,SAAS,mBAAmB,CAAC,SAAiB,EAAE,SAAiB;;IAE/D,QACE,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,MAAM,IAAI,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,MAAM;QAC9D,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,KAAK,CAAC,GAAG,IAAI,SAAS,CAAC,GAAG,CAAC,KAAK,SAAS,CAAC,GAAG,CAAC,CAAC,EACtE;AACJ,CAAC;AAED,SAAS,YAAY,CAAC,SAAkB,EAAE,SAAkB;IAC1D,QACE,mBAAmB,CAAC,SAAS,CAAC,WAAW,EAAE,SAAS,CAAC,WAAW,CAAC;QACjE,oBAAoB,CAAC,SAAS,CAAC,IAAI,EAAE,SAAS,CAAC,IAAI,EAAE,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,EAC7E;AACJ,CAAC;AAED,SAAS,oBAAoB,CAC3B,SAA0B,EAC1B,SAA0B,EAC1B,cAA4B;IAE5B,IAAI,SAAS,CAAC,QAAQ,CAAC,MAAM,GAAG,cAAc,CAAC,MAAM,EAAE;QACrD,MAAM,OAAO,GAAG,SAAS,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,EAAE,cAAc,CAAC,MAAM,CAAC,CAAC;QACnE,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,cAAc,CAAC;YAAE,OAAO,KAAK,CAAC;QACtD,IAAI,SAAS,CAAC,WAAW,EAAE;YAAE,OAAO,KAAK,CAAC;QAC1C,OAAO,IAAI,CAAC;KACb;SAAM,IAAI,SAAS,CAAC,QAAQ,CAAC,MAAM,KAAK,cAAc,CAAC,MAAM,EAAE;QAC9D,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,QAAQ,EAAE,cAAc,CAAC;YAAE,OAAO,KAAK,CAAC;QACjE,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE;YAAE,OAAO,IAAI,CAAC;QAE1C,KAAK,MAAM,CAAC,IAAI,SAAS,CAAC,QAAQ,EAAE;YAClC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC;gBAAE,MAAM;YAClC,IACE,oBAAoB,CAClB,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC,EACrB,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC,EACrB,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,QAAQ,CAC/B;gBAED,OAAO,IAAI,CAAC;SACf;QACD,OAAO,KAAK,CAAC;KACd;SAAM;QACL,MAAM,OAAO,GAAG,cAAc,CAAC,KAAK,CAAC,CAAC,EAAE,SAAS,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QACnE,MAAM,IAAI,GAAG,cAAc,CAAC,KAAK,CAAC,SAAS,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QAC7D,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,QAAQ,EAAE,OAAO,CAAC;YAAE,OAAO,KAAK,CAAC;QAC1D,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,cAAc,CAAC;YAAE,OAAO,KAAK,CAAC;QACtD,OAAO,oBAAoB,CAAC,SAAS,CAAC,QAAQ,CAAC,cAAc,CAAC,EAAE,SAAS,EAAE,IAAI,CAAC,CAAC;KAClF;AACH,CAAC;SAEe,SAAS,CAAC,EAAgB,EAAE,EAAgB;IAC1D,IAAI,EAAE,CAAC,MAAM,KAAK,EAAE,CAAC,MAAM;QAAE,OAAO,KAAK,CAAC;IAC1C,OAAO,EAAE,CAAC,KAAK,CACb,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,IAAI,KAAK,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CACxF,CAAC;AACJ;;MC/Da,aAAa;IAExB,YACU,OAAwB,EACxB,SAA0B,EACtB,IAAgB,EAChB,YAAgC;QAHpC,YAAO,GAAP,OAAO,CAAiB;QACxB,cAAS,GAAT,SAAS,CAAiB;QAIlC,IAAI,CAAC,GAAG,GAAG,IAAI,IAAI,YAAY,CAAC;KACjC;IAED,QAAQ;QACN,mBAAmB,CAAC;YAClB,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;YACrC,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC,SAAS,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC;SAChD,CAAC,CAAC;KACJ;;;YAtBF,SAAS,SAAC;gBACT,QAAQ,EAAE,cAAc;gBACxB,IAAI,EAAE;oBACJ,cAAc,EAAE,YAAY;iBAC7B;aACF;;;YAVwC,eAAe;YAC/C,eAAe;YADf,UAAU,uBAgBd,QAAQ;YAhBQ,kBAAkB,uBAiBlC,QAAQ;;WA8BP,UAAS,EAAY;IACnB,MAAM,KAAK,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;IACzB,OAAO,UAAU,CAAC;QAChB,EAAE,CAAC;YACD,UAAU,EAAE,KAAK;YACjB,aAAa,EAAE;gBACb,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,IAAI,IAAI,CAAC,GAAG,EAAE,GAAG,KAAK,CAAC,CAAC,CAAC;aAC/C;SACF,CAAC,CAAC;KACJ,EAAE,CAAC,CAAC,CAAC;AACR,CAAC,OACD,SAAQ;AAdd,MAAM,mBAAmB,GACvB,OAAO,MAAM,KAAK,WAAW;MACxB,MAAc,CAAC,mBAAmB,MAWlC;QACO;;MCvDD,oBAAoB;IAE/B,YAAoB,OAAe,EAAU,SAA0B;QAAnD,YAAO,GAAP,OAAO,CAAQ;QAAU,cAAS,GAAT,SAAS,CAAiB;QAD/D,aAAQ,GAAG,IAAI,GAAG,EAAS,CAAC;KACuC;IAE3E,OAAO,CAAC,KAAY,EAAE,IAAc;QAClC,IAAI,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE;;YAE5B,OAAO,KAAK,CAAC;SACd;;QAED,IAAI,KAAK,CAAC,IAAI,IAAI,KAAK,CAAC,IAAI,CAAC,OAAO,KAAK,KAAK,EAAE;YAC9C,OAAO,KAAK,CAAC;SACd;QACD,MAAM,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;QAClD,IAAI,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,EAAE;YACvC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;YACzB,OAAO,IAAI,EAAE,CAAC;SACf;QAED,OAAO,KAAK,CAAC;KACd;;;YArBF,UAAU;;;YAJkB,MAAM;YAE1B,eAAe;;AA0BxB,MAAM,QAAQ,GAAG,CAAC,MAAe,EAAE,KAAY;IAC7C,MAAM,GAAG,MAAM,CAAC,KAAK,EAAE,CAAC;IACxB,MAAM,MAAM,GAAG,IAAI,GAAG,EAAgB,CAAC;IACvC,MAAM,OAAO,GAAG,IAAI,GAAG,EAAS,CAAC;IACjC,OAAO,MAAM,CAAC,MAAM,EAAE;QACpB,MAAM,EAAE,GAAG,MAAM,CAAC,KAAK,EAAE,CAAC;QAC1B,IAAI,CAAC,EAAE,EAAE;YACP,MAAM;SACP;QACD,OAAO,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;QAChB,IAAI,EAAE,KAAK,KAAK;YAAE,MAAM;QACxB,IAAI,QAAQ,GAAG,EAAE,CAAC,QAAQ,IAAI,EAAE,CAAC;QACjC,MAAM,OAAO,GAAI,EAAU,CAAC,aAAa,CAAC;QAC1C,IAAI,OAAO,IAAI,OAAO,CAAC,MAAM,EAAE;YAC7B,QAAQ,GAAG,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;SAC5C;QACD,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAQ;YACxB,IAAI,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC;gBAAE,OAAO;YAC3B,MAAM,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;YAClB,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;SAChB,CAAC,CAAC;KACJ;IACD,IAAI,IAAI,GAAG,EAAE,CAAC;IACd,IAAI,OAAO,GAAG,KAAK,CAAC;IAEpB,OAAO,OAAO,EAAE;QACd,IAAI,cAAc,CAAC,OAAO,CAAC,EAAE;YAC3B,IAAI,GAAG,IAAI,OAAO,CAAC,IAAI,GAAG,IAAI,EAAE,CAAC;SAClC;aAAM;YACL,IAAI,GAAG,KAAK,OAAO,CAAC,MAAM,IAAI,OAAO,CAAC,IAAI,GAAG,IAAI,GAAG,CAAC;SACtD;QACD,OAAO,GAAG,MAAM,CAAC,GAAG,CAAC,OAAO,CAAE,CAAC;KAChC;IAED,OAAO,IAAI,CAAC;AACd,CAAC,CAAC;;AAEF,SAAS,cAAc,CAAC,KAAY;IAClC,OAAO,KAAK,CAAC,MAAM,KAAK,cAAc,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC;AAC1D;;MCzDa,kBAAkB;;;YAN9B,QAAQ,SAAC;gBACR,YAAY,EAAE,CAAC,aAAa,CAAC;gBAC7B,OAAO,EAAE,EAAE;gBACX,SAAS,EAAE,CAAC,oBAAoB,CAAC;gBACjC,OAAO,EAAE,CAAC,aAAa,CAAC;aACzB;;;ACVD;;;;ACAA;;;;;;"}