import { APP_BASE_HREF } from '@angular/common';
import { ÉµSERVER_CONTEXT as SERVER_CONTEXT } from '@angular/platform-server';
const EXTRA_PROVIDERS = [
    { provide: SERVER_CONTEXT, useValue: 'ngx-isr' },
];
// helper method that generates html of an url
export const renderUrl = async (options) => {
    const { req, res, url, indexHtml, providers } = options;
    // we need to override url of req with the one we have in parameters
    req.url = url;
    req.originalUrl = url;
    const BASE_URL_PROVIDER = {
        provide: APP_BASE_HREF,
        useValue: req.baseUrl,
    };
    return new Promise((resolve, reject) => {
        const allProviders = providers
            ? [...providers, ...EXTRA_PROVIDERS] // if providers are provided, we add them to the list
            : [...EXTRA_PROVIDERS, BASE_URL_PROVIDER]; // if not, we add the default providers
        res.render(indexHtml, { req, providers: allProviders }, async (err, html) => {
            if (err) {
                reject(err);
            }
            resolve(html);
        });
    });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVuZGVyLXVybC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1pc3Ivc3JjL2xpYi91dGlscy9yZW5kZXItdXJsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUVoRCxPQUFPLEVBQUUsZUFBZSxJQUFJLGNBQWMsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBVzdFLE1BQU0sZUFBZSxHQUFlO0lBQ2xDLEVBQUUsT0FBTyxFQUFFLGNBQWMsRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFO0NBQ2pELENBQUM7QUFFRiw4Q0FBOEM7QUFDOUMsTUFBTSxDQUFDLE1BQU0sU0FBUyxHQUFHLEtBQUssRUFBRSxPQUF3QixFQUFtQixFQUFFO0lBQzNFLE1BQU0sRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLEdBQUcsT0FBTyxDQUFDO0lBRXhELG9FQUFvRTtJQUNwRSxHQUFHLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztJQUNkLEdBQUcsQ0FBQyxXQUFXLEdBQUcsR0FBRyxDQUFDO0lBRXRCLE1BQU0saUJBQWlCLEdBQWE7UUFDbEMsT0FBTyxFQUFFLGFBQWE7UUFDdEIsUUFBUSxFQUFFLEdBQUcsQ0FBQyxPQUFPO0tBQ3RCLENBQUM7SUFFRixPQUFPLElBQUksT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFO1FBQ3JDLE1BQU0sWUFBWSxHQUFHLFNBQVM7WUFDNUIsQ0FBQyxDQUFDLENBQUMsR0FBRyxTQUFTLEVBQUUsR0FBRyxlQUFlLENBQUMsQ0FBQyxxREFBcUQ7WUFDMUYsQ0FBQyxDQUFDLENBQUMsR0FBRyxlQUFlLEVBQUUsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLHVDQUF1QztRQUVwRixHQUFHLENBQUMsTUFBTSxDQUNSLFNBQVMsRUFDVCxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEVBQ2hDLEtBQUssRUFBRSxHQUFVLEVBQUUsSUFBWSxFQUFFLEVBQUU7WUFDakMsSUFBSSxHQUFHLEVBQUU7Z0JBQ1AsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQ2I7WUFDRCxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDaEIsQ0FBQyxDQUNGLENBQUM7SUFDSixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFQUF9CQVNFX0hSRUYgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgUHJvdmlkZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IMm1U0VSVkVSX0NPTlRFWFQgYXMgU0VSVkVSX0NPTlRFWFQgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1zZXJ2ZXInO1xuaW1wb3J0IHsgUmVxdWVzdCwgUmVzcG9uc2UgfSBmcm9tICdleHByZXNzJztcblxuZXhwb3J0IGludGVyZmFjZSBSZW5kZXJVcmxDb25maWcge1xuICByZXE6IFJlcXVlc3Q7XG4gIHJlczogUmVzcG9uc2U7XG4gIHVybDogc3RyaW5nO1xuICBpbmRleEh0bWw6IHN0cmluZztcbiAgcHJvdmlkZXJzPzogUHJvdmlkZXJbXTtcbn1cblxuY29uc3QgRVhUUkFfUFJPVklERVJTOiBQcm92aWRlcltdID0gW1xuICB7IHByb3ZpZGU6IFNFUlZFUl9DT05URVhULCB1c2VWYWx1ZTogJ25neC1pc3InIH0sXG5dO1xuXG4vLyBoZWxwZXIgbWV0aG9kIHRoYXQgZ2VuZXJhdGVzIGh0bWwgb2YgYW4gdXJsXG5leHBvcnQgY29uc3QgcmVuZGVyVXJsID0gYXN5bmMgKG9wdGlvbnM6IFJlbmRlclVybENvbmZpZyk6IFByb21pc2U8c3RyaW5nPiA9PiB7XG4gIGNvbnN0IHsgcmVxLCByZXMsIHVybCwgaW5kZXhIdG1sLCBwcm92aWRlcnMgfSA9IG9wdGlvbnM7XG5cbiAgLy8gd2UgbmVlZCB0byBvdmVycmlkZSB1cmwgb2YgcmVxIHdpdGggdGhlIG9uZSB3ZSBoYXZlIGluIHBhcmFtZXRlcnNcbiAgcmVxLnVybCA9IHVybDtcbiAgcmVxLm9yaWdpbmFsVXJsID0gdXJsO1xuXG4gIGNvbnN0IEJBU0VfVVJMX1BST1ZJREVSOiBQcm92aWRlciA9IHtcbiAgICBwcm92aWRlOiBBUFBfQkFTRV9IUkVGLFxuICAgIHVzZVZhbHVlOiByZXEuYmFzZVVybCxcbiAgfTtcblxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIGNvbnN0IGFsbFByb3ZpZGVycyA9IHByb3ZpZGVyc1xuICAgICAgPyBbLi4ucHJvdmlkZXJzLCAuLi5FWFRSQV9QUk9WSURFUlNdIC8vIGlmIHByb3ZpZGVycyBhcmUgcHJvdmlkZWQsIHdlIGFkZCB0aGVtIHRvIHRoZSBsaXN0XG4gICAgICA6IFsuLi5FWFRSQV9QUk9WSURFUlMsIEJBU0VfVVJMX1BST1ZJREVSXTsgLy8gaWYgbm90LCB3ZSBhZGQgdGhlIGRlZmF1bHQgcHJvdmlkZXJzXG5cbiAgICByZXMucmVuZGVyKFxuICAgICAgaW5kZXhIdG1sLFxuICAgICAgeyByZXEsIHByb3ZpZGVyczogYWxsUHJvdmlkZXJzIH0sXG4gICAgICBhc3luYyAoZXJyOiBFcnJvciwgaHRtbDogc3RyaW5nKSA9PiB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuICAgICAgICByZXNvbHZlKGh0bWwpO1xuICAgICAgfVxuICAgICk7XG4gIH0pO1xufTtcbiJdfQ==