{"version":3,"file":"ngx-isr.mjs","sources":["../../../projects/ngx-isr/src/lib/ngx-isr.service.ts","../../../projects/ngx-isr/src/lib/models/cache-handler.ts","../../../projects/ngx-isr/src/lib/utils/get-isr-options.ts","../../../projects/ngx-isr/src/lib/cache-handlers/filesystem-cache-handler.ts","../../../projects/ngx-isr/src/lib/cache-handlers/in-memory-cache-handler.ts","../../../projects/ngx-isr/src/lib/utils/render-url.ts","../../../projects/ngx-isr/src/lib/cache-regeneration.ts","../../../projects/ngx-isr/src/lib/isr-logger.ts","../../../projects/ngx-isr/src/lib/isr-handler.ts","../../../projects/ngx-isr/src/lib/http-errors.interceptor.ts","../../../projects/ngx-isr/src/lib/utils/add-isr-data-before-serialized.ts","../../../projects/ngx-isr/src/lib/ngx-isr.module.ts","../../../projects/ngx-isr/src/public-api.ts","../../../projects/ngx-isr/src/ngx-isr.ts"],"sourcesContent":["import { Inject, Injectable, PLATFORM_ID } from '@angular/core';\nimport { DOCUMENT, isPlatformServer } from '@angular/common';\nimport { ChildActivationEnd, Router } from '@angular/router';\nimport { filter, map, take } from 'rxjs/operators';\nimport { BehaviorSubject } from 'rxjs';\nimport { HttpErrorResponse } from '@angular/common/http';\n\nexport interface NgxIsrState {\n  revalidate: number | null;\n  errors: Error[];\n  extra: Record<string, any>;\n}\n\nconst initialState: NgxIsrState = {\n  revalidate: null,\n  errors: [],\n  extra: {}\n}\n\n@Injectable({ providedIn: 'root' })\nexport class NgxIsrService {\n  protected state = new BehaviorSubject<NgxIsrState>(initialState);\n\n  getState(): NgxIsrState {\n    return this.state.getValue();\n  }\n\n  getExtra(): Record<string, any> {\n    return this.state.getValue().extra;\n  }\n\n  constructor(\n    @Inject(PLATFORM_ID) private platformId: Object,\n    @Inject(DOCUMENT) private doc: Document,\n    private router: Router\n  ) {\n    if (isPlatformServer(this.platformId)) {\n      this.activate();\n    }\n  }\n\n  activate(): void {\n    this.router.events\n      .pipe(\n        filter((e) => e instanceof ChildActivationEnd),\n        map((event) => {\n          let snapshot = (event as ChildActivationEnd).snapshot;\n          while (snapshot.firstChild !== null) {\n            snapshot = snapshot.firstChild;\n          }\n          return snapshot.data;\n        }),\n        take(1)\n      )\n      .subscribe((data: any) => {\n        if (data?.['revalidate'] !== undefined) {\n          this.setRevalidate(data['revalidate']);\n        }\n      });\n  }\n\n  addError(err: HttpErrorResponse): void {\n    const currentErrors = this.getState().errors;\n    this.state.next({ ...this.getState(), errors: [ ...currentErrors, err ] });\n  }\n\n  addExtra(extra: Record<string, any> = {}): void {\n    this.state.next({ ...this.getState(), extra: { ...this.getExtra(), ...extra } });\n  }\n  \n  setRevalidate = (revalidate: number | null): void => {\n    this.state.next({ ...this.getState(), revalidate });\n  }\n\n}\n","/**\n * Use the `revalidate` key in route data in order to define the time interval\n * that the ISR Handler should use in order to know when to regenerate a specific route.\n *\n *\n * Options:\n *\n * - Don't specify anything:\n *    The route won't be cached and will always be server-rendered. (Like SSR)\n *\n * - 0:\n *    First serve will be server-rendered and all the other ones will be served from cache. (Like SSG).\n *\n * - More than 0 (ex.: 5):\n *    First serve will be server-rendered and the cache will be regenerated every 5 seconds (after the last request).\n *\n * ### Example\n * ```typescript\n * const routes: Routes = [\n *   {\n *     path: \"one\",\n *     component: PageOneComponent\n *   },\n *   {\n *     path: \"two\",\n *     component: PageTwoComponent,\n *     data: { revalidate: 5 }\n *   },\n *   {\n *     path: \"three\",\n *     component: PageThreeComponent,\n *     data: { revalidate: 0 }\n *   }\n * ];\n * ```\n\n * - Path `one`:\n *    It won't be cached and will always be server-rendered before being served to the user.\n *\n * - Path `two`:\n *    The first request will be server-rendered and then will be cached.\n *    On the second request, it will be served from the cache that was saved on the first request.\n *    The url will be added to a regeneration queue, in order to re-generate the cache after `5` seconds.\n *    On the third request, if the regeneration was finished successfully\n *    the user will be served the regenerated page, otherwise he will be served with the old cached page.\n *\n * - Path `three`:\n *    The first request will be server-rendered and then will be cached.\n *    After the first request, all the other ones will be served from cache.\n *    So, the cache will never be refreshed automatically.\n *    The only way to refresh the cache is to make a request to /invalidate api route.\n */\nexport interface ISROptions {\n  revalidate: number | null; // none, 0, > 0\n  errors?: Error[];\n}\n\nexport interface CacheData {\n  html: string;\n  options: ISROptions;\n  createdAt: number;\n  deployId?: string; // TODO: this doesn't exist for Angular builds\n}\n\nexport abstract class CacheHandler {\n  abstract add(url: string, html: string, options?: ISROptions): Promise<void>\n\n  abstract get(url: string): Promise<CacheData>\n\n  abstract has(url: string): Promise<boolean>\n\n  abstract delete(url: string): Promise<boolean>\n\n  abstract getAll(): Promise<string[]>\n\n  abstract clearCache?(): Promise<boolean>\n}\n","import { ISROptions } from '../models';\n\n// this script tag will be included in the page if one of the routes on the page\n// has `revalidate` key in its route data\nconst isrScriptTag = '<script id=\"isr-state\" type=\"application/json\">';\n\nexport function getISROptions(html: string): ISROptions {\n  const indexOfScriptTag = html?.indexOf(isrScriptTag);\n\n  // check if script tag is not included\n  if (!html || indexOfScriptTag === -1) {\n    return { revalidate: null, errors: [] };\n  }\n\n  const isrScript = html.substring(indexOfScriptTag); // start from script till the end of html file\n  const indexOfCloseScriptTag = isrScript.indexOf(\"</script>\"); // first occurrence of closing script tag\n\n  const val = isrScript\n    .substring(0, indexOfCloseScriptTag) // remove close script tag\n    .replace(isrScriptTag, \"\") // remove start script tag\n\n  return JSON.parse(val);\n}\n","import { CacheData, CacheHandler, ISROptions } from '../models';\nimport * as fs from 'fs';\nimport { join } from 'path';\nimport { getISROptions } from '../utils/get-isr-options';\n\nexport interface FileSystemCacheOptions {\n  cacheFolderPath: string;\n  prerenderedPagesPath?: string;\n  addPrerenderedPagesToCache?: boolean;\n}\n\nexport class FileSystemCacheHandler implements CacheHandler {\n  protected cache = new Map<string, CacheData>();\n\n  private get cacheFolderPath(): string {\n    return this.options.cacheFolderPath;\n  }\n\n  constructor(public options: FileSystemCacheOptions) {\n    if (!options.cacheFolderPath) {\n      throw new Error('Cache folder path is required!');\n    }\n\n    if (options.addPrerenderedPagesToCache && !options.prerenderedPagesPath) {\n      throw new Error(\n        'Prerendered pages path is required when `addPrerenderedPagesToCache` is enabled!'\n      );\n    }\n\n    this.options = options;\n    this.populateCacheFromFilesystem();\n  }\n\n  async add(route: string, html: string, options?: ISROptions): Promise<void> {\n    return new Promise((resolve, reject) => {\n      route = route.charAt(0) === '/' ? route.slice(1) : route;\n      const fileName = convertRouteToFileName(route);\n      const filePath = `${this.getFileFullPath(fileName)}.html`;\n\n      fs.writeFile(filePath, html, 'utf-8', (err) => {\n        if (err) {\n          reject('Error: ðŸ’¥ The request was not cached!');\n        }\n\n        this.cache.set(route, {\n          html: filePath,\n          options: options || { revalidate: null },\n          createdAt: Date.now(),\n        });\n\n        console.log('The request was cached!', route);\n        resolve();\n      });\n    });\n  }\n\n  get(route: string): Promise<CacheData> {\n    return new Promise(async (resolve, reject) => {\n      const cachedUrl = this.cache.get(route);\n      if (cachedUrl) {\n        // on html field we have saved path to file\n        const html = await this.readFromFile(cachedUrl.html);\n        const cacheData: CacheData = {\n          ...cachedUrl,\n          html,\n        };\n        resolve(cacheData);\n      } else {\n        reject('Error: ðŸ’¥ Url is not cached.');\n      }\n    });\n  }\n\n  has(url: string): Promise<boolean> {\n    return Promise.resolve(this.cache.has(url));\n  }\n\n  delete(url: string): Promise<boolean> {\n    return new Promise((resolve, reject) => {\n      const cachedUrl = this.cache.get(url);\n\n      if (cachedUrl) {\n        const filePath = this.getFileFullPath(url);\n        fs.unlink(cachedUrl.html, (err) => {\n          if (err) {\n            reject('Error: ðŸ’¥ Cannot delete file' + filePath);\n          } else {\n            this.cache.delete(url);\n            resolve(true);\n          }\n        });\n      } else {\n        reject('Error: ðŸ’¥ Url is not cached.');\n      }\n    });\n  }\n\n  getAll(): Promise<string[]> {\n    const data = Array.from(this.cache.keys());\n    return Promise.resolve(data);\n  }\n\n  private populateCacheFromFilesystem(): void {\n    if (!fs.existsSync(this.cacheFolderPath)) {\n      console.log('Cache folder does not exist. Creating...');\n\n      fs.mkdir(this.cacheFolderPath, (err) => {\n        if (!err) {\n          console.log('Cache folder was created.');\n        }\n      });\n    }\n\n    if (this.options.addPrerenderedPagesToCache) {\n      console.log('Adding prerendered pages to cache...');\n      this.addPrerenderedPagesToCache();\n    }\n  }\n\n  private addPrerenderedPagesToCache() {\n    // read all folders in browser folder and check if they have index.html inside\n    // if yes add the folder name to cache as url and index.html as html\n    // then remove the found files because they will be handled by ISR\n\n    const folderPath = this.options.prerenderedPagesPath!;\n\n    const pathsToCache: Array<{ path: string; html: string }> = [];\n\n    try {\n      const files: string[] = fs.readdirSync(folderPath);\n\n      for (const file of files) {\n        const filePath = join(folderPath, file);\n        const isDirectory = fs.statSync(filePath).isDirectory();\n\n        if (isDirectory) {\n          const indexHtmlFiles = findIndexHtmlFilesRecursively(filePath);\n\n          pathsToCache.push(\n            ...indexHtmlFiles.map(({ path, html }) => ({\n              path: path.replace(folderPath, ''),\n              html,\n            }))\n          );\n        }\n      }\n    } catch (err) {\n      console.error('ERROR! ðŸ’¥ ! Cannot read folder: ' + folderPath);\n    }\n\n    for (const { path, html } of pathsToCache) {\n      const routePath = path.substring(0).replace('/index.html', '');\n      const { revalidate, errors } = getISROptions(html);\n      this.add(routePath, html, { revalidate, errors });\n    }\n\n    for (const { path } of pathsToCache) {\n      const file = join(this.options.prerenderedPagesPath!, path);\n      fs.rmSync(file, { recursive: true, force: true });\n    }\n  }\n\n  private async readFromFile(filePath: string): Promise<string> {\n    return new Promise((resolve, reject) => {\n      fs.readFile(filePath, 'utf-8', (err, data) => {\n        if (err) {\n          console.error('ERROR! ðŸ’¥ ! Cannot read file: ' + filePath);\n          reject(err);\n        }\n        resolve(data);\n      });\n    });\n  }\n\n  private getFileFullPath(fileName: string): string {\n    // fileName may have a / in the beginning, so we want to remove it first\n    if (fileName.charAt(0) === '/') {\n      fileName = fileName.slice(1);\n    }\n\n    return join(this.cacheFolderPath, '/', fileName);\n  }\n}\n\nfunction findIndexHtmlFilesRecursively(\n  path: string\n): Array<{ path: string; html: string }> {\n  const data: Array<{ path: string; html: string }> = [];\n\n  try {\n    const files = fs.readdirSync(path);\n    files.forEach((file: string) => {\n      const filePath = join(path, file);\n      if (fs.statSync(filePath).isDirectory()) {\n        data.push(...findIndexHtmlFilesRecursively(filePath));\n      } else if (file.includes('index.html')) {\n        const html = fs.readFileSync(filePath, 'utf8');\n        data.push({ path: filePath, html });\n      }\n    });\n  } catch (err) {\n    console.error('ERROR! ðŸ’¥ ! Cannot read folder: ' + path);\n    return [];\n  }\n\n  return data;\n}\n\nfunction convertRouteToFileName(route: string): string {\n  return route.replace(new RegExp('/', 'g'), '__');\n}\n","import { CacheData, CacheHandler, ISROptions } from \"../models\";\n\nexport class InMemoryCacheHandler implements CacheHandler {\n  protected cache = new Map<string, CacheData>();\n\n  add(url: string, html: string, options: ISROptions = { revalidate: null }): Promise<void> {\n\n    const htmlWithMsg = html + cacheMsg(options.revalidate);\n\n    return new Promise((resolve, reject) => {\n      const cacheData: CacheData = {\n        html: htmlWithMsg,\n        options,\n        createdAt: Date.now()\n      };\n      this.cache.set(url, cacheData);\n      resolve();\n    })\n  }\n\n  get(url: string): Promise<CacheData> {\n    return new Promise((resolve, reject) => {\n      if(this.cache.has(url)) {\n        resolve(this.cache.get(url)!);\n      }\n      reject('This url does not exist in cache!');\n    })\n  }\n\n  getAll(): Promise<string[]> {\n    return new Promise((resolve, reject) => {\n      resolve(Array.from(this.cache.keys()))\n    })\n  }\n\n  has(url: string): Promise<boolean> {\n    return new Promise((resolve, reject) => {\n      resolve(this.cache.has(url));\n    })\n  }\n\n  delete(url: string): Promise<boolean> {\n    return new Promise((resolve, reject) => {\n      resolve(this.cache.delete(url));\n    })\n  }\n}\n\nconst cacheMsg = (revalidateTime?: number | null): string => {\n  const time = new Date().toISOString()\n    .replace(/T/, ' ')\n    .replace(/\\..+/, '')\n\n  let msg = '<!-- ';\n\n  msg += `\\nðŸš€ NgxISR: Served from cache! \\nâŒ› Last updated: ${time}. `;\n\n  if (revalidateTime) {\n    msg += `\\nâ­ï¸ Next refresh is after ${revalidateTime} seconds. `;\n  }\n\n  msg += ' \\n-->';\n\n  return msg;\n}\n","import { APP_BASE_HREF } from '@angular/common';\nimport { Provider } from '@angular/core';\nimport { ÉµSERVER_CONTEXT as SERVER_CONTEXT } from '@angular/platform-server';\nimport { Request, Response } from 'express';\n\nexport interface RenderUrlConfig {\n  req: Request;\n  res: Response;\n  url: string;\n  indexHtml: string;\n  providers?: Provider[];\n}\n\nconst EXTRA_PROVIDERS: Provider[] = [\n  { provide: SERVER_CONTEXT, useValue: 'ngx-isr' },\n];\n\n// helper method that generates html of an url\nexport const renderUrl = async (options: RenderUrlConfig): Promise<string> => {\n  const { req, res, url, indexHtml, providers } = options;\n\n  // we need to override url of req with the one we have in parameters\n  req.url = url;\n  req.originalUrl = url;\n\n  const BASE_URL_PROVIDER: Provider = {\n    provide: APP_BASE_HREF,\n    useValue: req.baseUrl,\n  };\n\n  return new Promise((resolve, reject) => {\n    const allProviders = providers\n      ? [...providers, ...EXTRA_PROVIDERS] // if providers are provided, we add them to the list\n      : [...EXTRA_PROVIDERS, BASE_URL_PROVIDER]; // if not, we add the default providers\n\n    res.render(\n      indexHtml,\n      { req, providers: allProviders },\n      async (err: Error, html: string) => {\n        if (err) {\n          reject(err);\n        }\n        resolve(html);\n      }\n    );\n  });\n};\n","import { Provider } from '@angular/core';\nimport { CacheData, CacheHandler } from './models';\nimport { renderUrl } from './utils/render-url';\nimport { getISROptions } from './utils/get-isr-options';\nimport { Request, Response } from 'express';\nimport { ISRLogger } from './isr-logger';\n\nexport class CacheRegeneration {\n  // TODO: make this pluggable because on serverless environments we can't share memory between functions\n  // so we need to use a database or redis cache to store the urls that are on hold if we want to use this feature\n  private urlsOnHold: string[] = []; // urls that have regeneration loading\n\n  constructor(public cache: CacheHandler, public indexHtml: string) {}\n\n  async regenerate(\n    req: Request,\n    res: Response,\n    cacheData: CacheData,\n    logger: ISRLogger,\n    providers?: Provider[]\n  ): Promise<void> {\n    const { url } = req;\n\n    if (this.urlsOnHold.includes(url)) {\n      logger.log('Another regeneration is on-going...');\n      return;\n    }\n\n    const { options } = cacheData;\n    const { revalidate } = options;\n\n    logger.log(`The url: ${url} is being regenerated.`);\n\n    this.urlsOnHold.push(url);\n\n    renderUrl({ req, res, url, indexHtml: this.indexHtml, providers }).then(\n      (html) => {\n        const { errors } = getISROptions(html);\n\n        if (errors?.length) {\n          logger.log('ðŸ’¥ ERROR: Url: ' + url + ' was not regenerated!', errors);\n          return;\n        }\n\n        // add the regenerated page to cache\n        this.cache.add(req.url, html, { revalidate }).then(() => {\n          // remove url from urlsOnHold\n          this.urlsOnHold = this.urlsOnHold.filter((x) => x !== url);\n          logger.log('Url: ' + url + ' was regenerated!');\n        });\n      }\n    );\n  }\n}\n","export class ISRLogger {\n    constructor(private showLogs: boolean) {}\n\n    log(message?: any, ...optionalParams: any[]): void {\n        this.showLogs && console.log(message, ...optionalParams);\n    }\n}","import {\n  CacheHandler,\n  InvalidateConfig,\n  ISRHandlerConfig,\n  RenderConfig,\n  ServeFromCacheConfig,\n} from './models';\nimport { InMemoryCacheHandler } from './cache-handlers';\nimport { renderUrl, RenderUrlConfig } from './utils/render-url';\nimport { getISROptions } from './utils/get-isr-options';\nimport { CacheRegeneration } from './cache-regeneration';\nimport { NextFunction, Request, Response } from 'express';\nimport { ISRLogger } from './isr-logger';\n\nexport class ISRHandler {\n  protected cache!: CacheHandler;\n  protected cacheRegeneration!: CacheRegeneration;\n\n  protected isrConfig: ISRHandlerConfig;\n\n  protected readonly logger: ISRLogger;\n\n  constructor(config?: ISRHandlerConfig) {\n    if (!config) {\n      throw new Error('Provide ISRHandlerConfig!');\n    }\n\n    this.isrConfig = config;\n\n    this.logger = new ISRLogger(config?.enableLogging ?? false);\n\n    // if skipCachingOnHttpError is not provided it will default to true\n    this.isrConfig.skipCachingOnHttpError =\n      config?.skipCachingOnHttpError !== false;\n\n    if (config.cache && config.cache instanceof CacheHandler) {\n      this.logger.log('Using custom cache handler!');\n      this.cache = config.cache;\n    } else {\n      this.logger.log('Using in memory cache handler!');\n      this.cache = new InMemoryCacheHandler();\n    }\n\n    this.cacheRegeneration = new CacheRegeneration(\n      this.cache,\n      config.indexHtml\n    );\n  }\n\n  async invalidate(\n    req: Request,\n    res: Response,\n    config?: InvalidateConfig\n  ): Promise<any> {\n    const { token, urlsToInvalidate } = extractDataFromBody(req);\n    const { indexHtml } = this.isrConfig;\n\n    if (token !== this.isrConfig.invalidateSecretToken) {\n      return res.json({ status: 'error', message: 'Your secret token is wrong!!!' });\n    }\n\n    if (!urlsToInvalidate || !urlsToInvalidate.length) {\n      return res.json({ status: 'error', message: 'Please add `urlsToInvalidate` in the payload!' });\n    }\n\n    const notInCache: string[] = [];\n    const urlWithErrors: Record<string, any> = {};\n\n    for (const url of urlsToInvalidate) {\n      const urlExists = await this.cache.has(url);\n\n      if (!urlExists) {\n        notInCache.push(url);\n        continue;\n      }\n\n      try {\n        // re-render the page again\n        const html = await renderUrl({ req, res, url, indexHtml, providers: config?.providers });\n\n        // get revalidate data in order to set it to cache data\n        const { revalidate, errors } = getISROptions(html);\n\n        // if there are errors when rendering the site we throw an error\n        if (errors?.length && this.isrConfig.skipCachingOnHttpError) {\n          urlWithErrors[url] = errors;\n        }\n        // add the regenerated page to cache\n        await this.cache.add(req.url, html, { revalidate });\n      } catch (err) {\n        urlWithErrors[url] = err;\n      }\n\n    }\n\n    const invalidatedUrls = urlsToInvalidate.filter(url => !notInCache.includes(url) && !urlWithErrors[url]);\n\n    if (notInCache.length) {\n      this.logger.log(`Urls: ${ notInCache.join(', ') } does not exist in cache.`);\n    }\n\n    if (Object.keys(urlWithErrors).length) {\n      this.logger.log(`Urls: ${Object.keys(urlWithErrors).join(', ')} had errors while regenerating!`);\n    }\n\n    if (invalidatedUrls.length) {\n      this.logger.log(`Urls: ${ invalidatedUrls.join(', ') } were regenerated!`);\n    }\n\n    const response = { status: 'success', notInCache, urlWithErrors, invalidatedUrls };\n    return res.json(response);\n  }\n\n  async serveFromCache(\n    req: Request,\n    res: Response,\n    next: NextFunction,\n    config?: ServeFromCacheConfig\n  ): Promise<any> {\n    try {\n      const cacheData = await this.cache.get(req.url);\n      const { html, options, createdAt } = cacheData;\n\n      // if the cache is expired, we will regenerate it\n      if (options.revalidate && options.revalidate > 0) {\n        const lastCacheDateDiff = (Date.now() - createdAt) / 1000; // in seconds\n\n        if (lastCacheDateDiff > options.revalidate) {\n          await this.cacheRegeneration.regenerate(\n            req,\n            res,\n            cacheData,\n            this.logger,\n            config?.providers\n          );\n        }\n      }\n\n      // Apply the callback if given\n      let finalHtml = html;\n      if(config?.modifyCachedHtml) {\n        const timeStart = performance.now();\n        finalHtml = config.modifyCachedHtml(req, html);\n        const totalTime = performance.now() - timeStart;\n        finalHtml += `<!--\\nâ„¹ï¸ NgxISR: This cachedHtml has been modified with modifyCachedHtml()\\nâ—ï¸ This resulted into more ${totalTime.toFixed(2)}ms of processing time.\\n-->`;\n      }\n\n      // Cache exists. Send it.\n      this.logger.log(`Page was retrieved from cache: `, req.url);\n      return res.send(finalHtml);\n    } catch (error) {\n      // Cache does not exist. Serve user using SSR\n      next();\n    }\n  }\n\n  async render(\n    req: Request,\n    res: Response,\n    next: NextFunction,\n    config?: RenderConfig\n  ): Promise<any> {\n    const renderUrlConfig: RenderUrlConfig = {\n      req,\n      res,\n      url: req.url,\n      indexHtml: this.isrConfig.indexHtml,\n      providers: config?.providers,\n    };\n\n    renderUrl(renderUrlConfig).then(async (html) => {\n      const { revalidate, errors } = getISROptions(html);\n\n      // Apply the callback if given\n      const finalHtml = config?.modifyGeneratedHtml ? config.modifyGeneratedHtml(req, html) : html;\n\n      // if we have any http errors when rendering the site, and we have skipCachingOnHttpError enabled\n      // we don't want to cache it, and, we will fall back to client side rendering\n      if (errors?.length && this.isrConfig.skipCachingOnHttpError) {\n        this.logger.log('Http errors: \\n', errors);\n        return res.send(finalHtml);\n      }\n\n      // if revalidate is null we won't cache it\n      // if revalidate is 0, we will never clear the cache automatically\n      // if revalidate is x, we will clear cache every x seconds (after the last request) for that url\n\n      if (revalidate === null || revalidate === undefined) {\n        // don't do !revalidate because it will also catch \"0\"\n        return res.send(finalHtml);\n      }\n\n      // Cache the rendered `html` for this request url to use for subsequent requests\n      await this.cache.add(req.url, finalHtml, { revalidate });\n      return res.send(finalHtml);\n    });\n  }\n}\n\nconst extractDataFromBody = (\n  req: Request\n): { token: string | null; urlsToInvalidate: string[] } => {\n  const { urlsToInvalidate, token } = req.body;\n  return { urlsToInvalidate, token };\n};\n","import { Injectable, Provider } from '@angular/core';\nimport { HTTP_INTERCEPTORS, HttpEvent, HttpHandler, HttpInterceptor, HttpRequest } from '@angular/common/http';\nimport { catchError, Observable, throwError } from 'rxjs';\nimport { NgxIsrService } from './ngx-isr.service';\n\n@Injectable()\nexport class HttpErrorsInterceptor implements HttpInterceptor {\n\n  constructor(private ngxIsrService: NgxIsrService) {}\n\n  intercept(request: HttpRequest<unknown>, next: HttpHandler): Observable<HttpEvent<unknown>> {\n    return next.handle(request).pipe(\n      catchError(err => {\n        this.ngxIsrService.addError(err);\n        return throwError(() => err);\n      })\n    );\n  }\n}\n\nexport const HTTP_ERROR_PROVIDER_ISR: Provider = {\n  provide: HTTP_INTERCEPTORS,\n  useClass: HttpErrorsInterceptor,\n  multi: true,\n}\n","import { NgxIsrService, NgxIsrState } from '../ngx-isr.service';\n\nexport function addIsrDataBeforeSerialized(isrService: NgxIsrService, doc: Document): () => Promise<void> {\n  return () => addISRDataToBody(doc, isrService.getState());\n}\n\n// append script with revalidate and errors data for the current route\nfunction addISRDataToBody(doc: Document, { revalidate, errors, extra }: NgxIsrState): Promise<void> {\n  return new Promise<void>(resolve => {\n    const script = doc.createElement('script');\n    script.id = 'isr-state';\n    script.setAttribute('type', 'application/json');\n\n    let toBeSerialized: any = { revalidate };\n\n    if (errors.length) toBeSerialized = { ...toBeSerialized, errors };\n    if (Object.keys(extra).length) toBeSerialized = { ...toBeSerialized, extra };\n\n    script.textContent = JSON.stringify(toBeSerialized);\n    doc.body.appendChild(script);\n    resolve();\n  })\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\nimport { NgxIsrService } from './ngx-isr.service';\nimport { HTTP_ERROR_PROVIDER_ISR } from './http-errors.interceptor';\nimport { BEFORE_APP_SERIALIZED } from '@angular/platform-server';\nimport { addIsrDataBeforeSerialized } from './utils/add-isr-data-before-serialized';\nimport { DOCUMENT } from '@angular/common';\n\n@NgModule({ providers: [ NgxIsrService ] })\nexport class NgxIsrModule {\n  constructor(private isrService: NgxIsrService) {}\n\n  static forRoot(): ModuleWithProviders<NgxIsrModule> {\n    return {\n      ngModule: NgxIsrModule,\n      providers: [\n        NgxIsrService,\n        HTTP_ERROR_PROVIDER_ISR,\n        {\n          provide: BEFORE_APP_SERIALIZED,\n          useFactory: addIsrDataBeforeSerialized,\n          multi: true,\n          deps: [ NgxIsrService, DOCUMENT ]\n        },\n      ]\n    }\n  }\n\n}\n","/*\n * Public API Surface of ngx-isr\n */\n\nexport * from './lib/ngx-isr.service';\nexport * from './lib/isr-handler';\n\nexport { InMemoryCacheHandler, FileSystemCacheHandler } from './lib/cache-handlers';\n\nexport { NgxIsrModule } from './lib/ngx-isr.module';\n\nexport {\n  ISRHandlerConfig,\n  InvalidateConfig,\n  RenderConfig,\n  ServeFromCacheConfig,\n} from './lib/models/isr-handler-config';\n\n\nexport { CacheHandler, ISROptions, CacheData } from './lib/models/cache-handler';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["SERVER_CONTEXT","i1.NgxIsrService"],"mappings":"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"}